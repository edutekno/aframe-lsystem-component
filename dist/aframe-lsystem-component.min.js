!function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function s(t){let e=t.split(/(\w)\s*:\s*/).filter(t=>0!==t.length),i=[];for(var s=0;s<e.length;s+=2)i.push([e[s],e[s+1]]);return i}var o,r,n,a;if(Object.defineProperty(e,"__esModule",{value:!0}),o=i(1),r=i(2),n=i.n(r),a=i(4),i.n(a),"undefined"==typeof AFRAME)throw Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("lsystem",{schema:{axiom:{type:"string",default:"F"},productions:{default:"F:FF",parse:t=>s(t).map(([t,e])=>[t,e.replace(/\s/g,"")])},segmentMixins:{type:"string",parse:function(t){let e=new Map,i=s(t);for(let[t,s]of i)s=s.replace(/[\[\]]/g,"").split(","),e.set(t,s);return e}},iterations:{type:"int",default:1},angle:{default:90},translateAxis:{type:"string",default:"y",parse:function(t){if("x"===(t=t.toLowerCase()))return new THREE.Vector3(1,0,0);if("y"===t)return new THREE.Vector3(0,1,0);if("z"===t)return new THREE.Vector3(0,0,1);throw Error('translateAxis has to be a string: "x", "y" or "z"')}},scaleFactor:{default:1},dynamicSegmentLength:{default:!0},mergeGeometries:{type:"boolean",default:!0},functionsInProductions:{type:"boolean",default:!0}},init:function(){this.sceneEl=document.querySelector("a-scene");let t=this;this.initWorker(),this.X=new THREE.Vector3(1,0,0),this.Y=new THREE.Vector3(0,1,0),this.Z=new THREE.Vector3(0,0,1),this.xPosRotation=new THREE.Quaternion,this.xNegRotation=new THREE.Quaternion,this.yPosRotation=new THREE.Quaternion,this.yNegRotation=new THREE.Quaternion,this.zPosRotation=new THREE.Quaternion,this.zNegRotation=new THREE.Quaternion,this.yReverseRotation=new THREE.Quaternion,this.xPosRotation=new THREE.Quaternion,this.xNegRotation=new THREE.Quaternion,this.yPosRotation=new THREE.Quaternion,this.yNegRotation=new THREE.Quaternion,this.zPosRotation=new THREE.Quaternion,this.zNegRotation=new THREE.Quaternion,this.yReverseRotation=new THREE.Quaternion,this.segmentLengthFactor=1;let e=t.data.scaleFactor;this.colorIndex=0,this.lineWidth=5e-4,this.lineLength=.125,this.LSystem=new o.a({axiom:"F",productions:{F:"F"},finals:{"+":()=>{t.transformationSegment.quaternion.multiply(t.yPosRotation)},"-":()=>{t.transformationSegment.quaternion.multiply(t.yNegRotation)},"&":()=>{t.transformationSegment.quaternion.multiply(t.zNegRotation)},"^":()=>{t.transformationSegment.quaternion.multiply(t.zPosRotation)},"\\":()=>{t.transformationSegment.quaternion.multiply(t.xNegRotation)},"<":()=>{t.transformationSegment.quaternion.multiply(t.xNegRotation)},"/":()=>{t.transformationSegment.quaternion.multiply(t.xPosRotation)},">":()=>{t.transformationSegment.quaternion.multiply(t.xPosRotation)},"|":()=>{t.transformationSegment.quaternion.multiply(t.yReverseRotation)},"!":()=>{t.segmentLengthFactor*=e,t.transformationSegment.scale.set(t.transformationSegment.scale.x*=e,t.transformationSegment.scale.y*=e,t.transformationSegment.scale.z*=e),t.colorIndex++},"'":()=>{t.segmentLengthFactor*=1/e,t.transformationSegment.scale.set(t.transformationSegment.scale.x*=1/e,t.transformationSegment.scale.y*=1/e,t.transformationSegment.scale.z*=1/e),t.colorIndex=Math.max(0,t.colorIndex-1)},"[":()=>{t.stack.push(t.transformationSegment.clone())},"]":()=>{t.transformationSegment=t.stack.pop()}}})},update:function(t){if(!1===this.data.mergeGeometries&&void 0!==this.segmentElementGroupsMap)for(let t of this.segmentElementGroupsMap.values())t.removeObject3D("mesh"),t.innerHTML="";if(0===Object.keys(t).length)this.updateLSystem(),this.updateSegmentMixins(),this.updateTurtleGraphics();else{let e=!1;(t.axiom&&t.axiom!==this.data.axiom||t.iterations&&t.iterations!==this.data.iterations||t.productions&&JSON.stringify(t.productions)!==JSON.stringify(this.data.productions))&&(this.updateLSystem(),e=!0),void 0!==t.segmentMixins&&JSON.stringify(Array.from(t.segmentMixins.entries()))!==JSON.stringify(Array.from(this.data.segmentMixins.entries()))&&(this.updateSegmentMixins(),e=!0),(e||t.angle&&t.angle!==this.data.angle)&&this.updateTurtleGraphics()}},calculateSegmentLength:function(t,e){if(this.segmentLengthMap.has(t))return this.segmentLengthMap.get(t);e.computeBoundingBox();let i;return this.data.translateAxis.equals(this.X)?i=Math.abs(e.boundingBox.min.x-e.boundingBox.max.x):this.data.translateAxis.equals(this.Y)?i=Math.abs(e.boundingBox.min.y-e.boundingBox.max.y):this.data.translateAxis.equals(this.Z)&&(i=Math.abs(e.boundingBox.min.z-e.boundingBox.max.z)),this.segmentLengthMap.set(t,i),i},initWorker:function(){this.worker=new n.a},pushSegment:function(t){let e=this,i=e.transformationSegment.quaternion.clone(),s=e.transformationSegment.position.clone(),o=e.transformationSegment.scale.clone(),r=Math.min(this.colorIndex,this.data.segmentMixins.get(t).length-1),n=this.mixinMap.get(t+r);if(!1===this.data.mergeGeometries){let a=document.createElement("a-entity");a.setAttribute("mixin",n),a.addEventListener("loaded",()=>{let t=e.segmentLengthMap.get(n);a.object3D.children[0].translateOnAxis(e.data.translateAxis,t*e.segmentLengthFactor/2),a.object3D.quaternion.copy(i),a.object3D.position.copy(s),a.object3D.scale.copy(o)},{once:!0}),this.segmentElementGroupsMap.get(t+r).appendChild(a)}else{let e=this.segmentObjects3DMap.get(t+r).clone();e.quaternion.copy(i),e.position.copy(s),e.scale.copy(o),e.matrixAutoUpdate=!1,e.updateMatrix(),this.mergeGroups.get(t+r).geometry.merge(e.geometry,e.matrix)}let a=this.segmentLengthMap.get(n);this.transformationSegment.translateOnAxis(this.data.translateAxis,a*this.segmentLengthFactor)},updateLSystem:function(){let t=this,e={axiom:this.data.axiom,productions:this.data.productions,iterations:this.data.iterations};return Date.now()-this.worker.startTime>1e3&&(this.worker.terminate(),this.initWorker()),this.worker.startTime=Date.now(),this.workerPromise=new Promise(e=>{this.worker.onmessage=(i=>{t.LSystem.setAxiom(i.data.result),e()})}),this.worker.postMessage(e),this.workerPromise},updateSegmentMixins:function(){let t=this;this.el.innerHTML="",this.segmentElementGroupsMap=new Map,this.mixinMap=new Map;for(let[t,e]of this.data.segmentMixins)for(let i=0;i<e.length;i++)this.mixinMap.set(t+i,e[i]);if(this.segmentObjects3DMap=new Map,this.segmentLengthMap=new Map,this.mergeGroups=new Map,this.mixinPromises=[],this.data.segmentMixins&&0!==this.data.segmentMixins.length)for(let e of this.data.segmentMixins){let[i,s]=e;this.LSystem.setFinal(i,()=>{t.pushSegment.bind(t,i)()});for(let e=0;e<s.length;e++){let o=e,r=s[o];t.mixinPromises.push(new Promise(e=>{let s=document.createElement("a-entity");if(s.setAttribute("id",r+"-group-"+o+Math.floor(1e4*Math.random())),s.setAttribute("geometry","buffer",!1),s.setAttribute("mixin",r),s.addEventListener("loaded",function(){let n=s.getObject3D("mesh").clone();s.getObject3D("mesh").geometry.dispose(),n.geometry=n.geometry.clone();let a=t.calculateSegmentLength(r,n.geometry);if(!0===t.data.mergeGeometries){let e=t.data.translateAxis.clone().multiplyScalar(a*t.segmentLengthFactor/2);n.geometry.translate(e.x,e.y,e.z),t.segmentObjects3DMap.set(i+o,n)}s.removeObject3D("mesh"),e()},{once:!0}),this.segmentElementGroupsMap.has(i+o)){let t=this.segmentElementGroupsMap.get(i+o);this.segmentElementGroupsMap.delete(i+o),this.el.removeChild(t)}this.segmentElementGroupsMap.set(i+o,s),this.el.appendChild(s)}))}}},updateTurtleGraphics:function(){Promise.all([...this.mixinPromises,this.workerPromise]).then(()=>{if(this.transformationSegment=new THREE.Object3D,!0===this.data.mergeGeometries)for(let[t,e]of this.segmentObjects3DMap)this.mergeGroups.set(t,new THREE.Mesh(new THREE.Geometry,e.material));this.stack=[];let t=this.data.angle;if(this.xPosRotation.setFromAxisAngle(this.X,Math.PI/180*t),this.xNegRotation.setFromAxisAngle(this.X,Math.PI/180*-t),this.yPosRotation.setFromAxisAngle(this.Y,Math.PI/180*t),this.yNegRotation.setFromAxisAngle(this.Y,Math.PI/180*-t),this.yReverseRotation.setFromAxisAngle(this.Y,Math.PI/180*180),this.zPosRotation.setFromAxisAngle(this.Z,Math.PI/180*t),this.zNegRotation.setFromAxisAngle(this.Z,Math.PI/180*-t),this.LSystem.final(),!0===this.data.mergeGeometries)for(let t of this.segmentElementGroupsMap){let[e,i]=t;0===this.mergeGroups.get(e).geometry.vertices.length?this.el.removeChild(i):(i.setObject3D("mesh",this.mergeGroups.get(e)),i.setAttribute("mixin",this.mixinMap.get(e)))}})},remove:function(){},tick:function(){},pause:function(){},play:function(){}})},function(t,e){"use strict";function i(t){var e,i,s=t[0].match(/(.+)<(.)/),o=t[0].match(/(.)>(.+)/);return null===s&&null===o?t:(e=void 0,i=t[1].successor||t[1].successors?t[1]:{successor:t[1]},null!==s&&(e=s[2],i.leftCtx=s[1]),null!==o&&(e=o[1],i.rightCtx=o[2]),[e,i])}function s(t){var e,i,s,o,r,n;if("string"!=typeof t&&t instanceof String==!1)return t;for(e=[],i=t,o=0,i=(s=Array.isArray(i))?i:i[Symbol.iterator]();;){if(s){if(o>=i.length)break;r=i[o++]}else{if((o=i.next()).done)break;r=o.value}n=r,e.push({symbol:n})}return e}function o(t,e){if(t.hasOwnProperty("successors"))for(var i=0;i<t.successors.length;i++)t.successors[i]=o(t.successors[i],e);else!1===t.hasOwnProperty("successor")&&(t={successor:t});return e&&t.hasOwnProperty("successor")&&(t.successor=s(t.successor)),t}function r(t,e){return t[1]=o(t[1],e),t}function LSystem(t){var e=t.axiom,o=void 0===e?"":e,n=t.productions,a=t.finals,c=t.branchSymbols,h=void 0===c?"":c,u=t.ignoredSymbols,l=void 0===u?"":u,m=t.allowClassicSyntax,f=void 0===m||m,d=t.classicParametricSyntax,g=void 0!==d&&d,p=t.forceObjects,y=void 0!==p&&p,x=t.debug,b=void 0!==x&&x;return this.setAxiom=function(t){this.axiom=this.forceObjects?s(t):t},this.getRaw=function(){return this.axiom},this.getString=function(){var t=0>=arguments.length||void 0===arguments[0]||arguments[0];return"string"==typeof this.axiom?this.axiom:!0===t?this.axiom.reduce((t,e)=>{if(void 0===e.symbol)throw console.log("found:",e),Error("L-Systems that use only objects as symbols (eg: {symbol: 'F', params: []}), cant use string symbols (eg. 'F')! Check if you always return objects in your productions and no strings.");return t+e.symbol},""):JSON.stringify(this.axiom)},this.getStringResult=this.getString,this.setProduction=function(t,e){var s,o,n,a,c,h,u,l,m,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=[t,e];if(void 0===d)throw Error("no production specified.");if(e.successor&&e.successors)throw Error('You can not have both a "successor" and a "successors" field in your production!');if(!0===this.allowClassicSyntax&&(d=i(d,this.ignoredSymbols)),d=r(d,this.forceObjects),d[1].isStochastic=void 0!==d[1].successors&&d[1].successors.every(t=>void 0!==t.weight),d[1].isStochastic)for(d[1].weightSum=0,s=d[1].successors,n=0,s=(o=Array.isArray(s))?s:s[Symbol.iterator]();;){if(o){if(n>=s.length)break;a=s[n++]}else{if((n=s.next()).done)break;a=n.value}c=a,d[1].weightSum+=c.weight}h=d[0],!0===f&&this.productions.has(h)?(l=(u=this.productions.get(h)).successor,m=u.successors,l&&!m&&(u={successors:[u]}),u.successors.push(d[1]),this.productions.set(h,u)):this.productions.set(h,d[1])},this.setProductions=function(t){var e,i,s,o,r,n,a;if(void 0===t)throw Error("no production specified.");for(this.clearProductions(),e=Object.entries(t),s=0,e=(i=Array.isArray(e))?e:e[Symbol.iterator]();;){if(i){if(s>=e.length)break;o=e[s++]}else{if((s=e.next()).done)break;o=s.value}n=(r=o)[0],a=r[1],this.setProduction(n,a,!0)}},this.clearProductions=function(){this.productions=new Map},this.setFinal=function(t,e){var i=[t,e];if(void 0===i)throw Error("no final specified.");this.finals.set(i[0],i[1])},this.setFinals=function(t){if(void 0===t)throw Error("no finals specified.");this.finals=new Map;for(var e in t)t.hasOwnProperty(e)&&this.setFinal(e,t[e])},this.getProductionResult=function(t,e,i,s){var o,r,n,a,c,h,u,m,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=void 0!==t.leftCtx||void 0!==t.rightCtx,g=!1,p=!0;if(void 0!==t.condition&&!1===t.condition({index:e,currentAxiom:this.axiom,part:i,params:s})?p=!1:d&&(void 0!==t.leftCtx&&void 0!==t.rightCtx?p=this.match({direction:"left",match:t.leftCtx,index:e,branchSymbols:"[]"}).result&&this.match({direction:"right",match:t.rightCtx,index:e,branchSymbols:"[]",ignoredSymbols:l}).result:void 0!==t.leftCtx?p=this.match({direction:"left",match:t.leftCtx,index:e,branchSymbols:"[]"}).result:void 0!==t.rightCtx&&(p=this.match({direction:"right",match:t.rightCtx,index:e,branchSymbols:"[]"}).result)),!1===p)g=!1;else if(t.successors)for(t.isStochastic&&(r=Math.random()*t.weightSum,o=0),n=t.successors,c=0,n=(a=Array.isArray(n))?n:n[Symbol.iterator]();;){if(a){if(c>=n.length)break;h=n[c++]}else{if((c=n.next()).done)break;h=c.value}if(u=h,!(t.isStochastic&&(o+=u.weight)<r||void 0===(m=this.getProductionResult(u,e,i,s,!0))||!1===m)){g=m;break}}else g="function"==typeof t.successor?t.successor({index:e,currentAxiom:this.axiom,part:i,params:s}):t.successor;return g||(f?g:i)},this.applyProductions=function(){var t,e,i,s,o,r,n,a,c,h="string"==typeof this.axiom?"":[],u=0;for(t=this.axiom,i=0,t=(e=Array.isArray(t))?t:t[Symbol.iterator]();;){if(e){if(i>=t.length)break;s=t[i++]}else{if((i=t.next()).done)break;s=i.value}r=(o=s).symbol||o,n=o.params||[],a=o,this.productions.has(r)&&(c=this.productions.get(r),a=this.getProductionResult(c,u,o,n)),"string"==typeof h?h+=a:a instanceof Array?Array.prototype.push.apply(h,a):h.push(a),u++}return this.axiom=h,h},this.iterate=function(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(this.iterations=i,t=void 0,e=0;i>e;e++)t=this.applyProductions();return t},this.final=function(t){var e,i,s,o,r,n,a,c,h=0;for(e=this.axiom,s=0,e=(i=Array.isArray(e))?e:e[Symbol.iterator]();;){if(i){if(s>=e.length)break;o=e[s++]}else{if((s=e.next()).done)break;o=s.value}if(r=o,n=r,"object"==typeof r&&r.symbol&&(n=r.symbol),this.finals.has(n)){if(a=this.finals.get(n),"function"!==(c=typeof a))throw Error("'"+n+"' has an object for a final function. But it is __not a function__ but a "+c+"!");a({index:h,part:r},t)}h++}},this.match=function(t){var e,i,s,o,r,n,a,c,h,u,l,m,f=t.axiom_,d=t.match,g=t.ignoredSymbols,p=t.branchSymbols,y=t.index,x=t.direction,b=0,v=0;if(f=f||this.axiom,void 0===p&&(p=void 0!==this.branchSymbols?this.branchSymbols:[]),void 0===g&&(g=void 0!==this.ignoredSymbols?this.ignoredSymbols:[]),e=[],i=void 0,s=void 0,o=void 0,r=void 0,n=void 0,a=void 0,c=void 0,"right"===x)r=a=1,o=y+1,n=0,c=d.length,p.length>0&&(i=(h=p)[0],s=h[1]);else{if("left"!==x)throw Error(x,"is not a valid direction for matching.");r=a=-1,o=y-1,n=d.length-1,c=-1,p.length>0&&(s=(u=p)[0],i=u[1])}for(;o<f.length&&o>=0;o+=r)if(l=f[o].symbol||f[o],m=d[n],l===m){if((0===b||v>0)&&(l===i?(v++,b++,n+=a):l===s?(v=Math.max(0,v-1),b=Math.max(0,b-1),0===v&&(n+=a)):(e.push(o),n+=a)),n===c)return{result:!0,matchIndices:e}}else if(l===i)b++,v>0&&v++;else if(l===s)b=Math.max(0,b-1),v>0&&(v=Math.max(0,v-1));else if((0===b||v>0&&m!==s)&&!1===g.includes(l))return{result:!1,matchIndices:e};return{result:!1,matchIndices:e}},this.ignoredSymbols=l,this.debug=b,this.branchSymbols=h,this.allowClassicSyntax=f,this.classicParametricSyntax=g,this.forceObjects=y,this.setAxiom(o),this.clearProductions(),n&&this.setProductions(n),a&&this.setFinals(a),this}LSystem.transformClassicStochasticProductions=function(t){return function(){var e,i=t,s=i.length,o=Math.random();for(e=0;s>e;e++)if((e+1)/s>=o)return i[e];console.error("Should have returned a result of the list, something is wrong here with the random numbers?.")}},LSystem.transformClassicCSProduction=i,LSystem.transformClassicParametricAxiom=function(t){var e,i,s=t.replace(/\s+/g,"").split(/[\(\)]/),o=[];for(e=0;e<s.length-1;e+=2)i=s[e+1].split(",").map(Number),o.push({symbol:s[e],params:i})},LSystem.testClassicParametricSyntax=function(t){return/\(.+\)/.test(t)},e.a=LSystem},function(t,e,i){t.exports=function(){return i(3)('!function(t){function i(o){if(s[o])return s[o].exports;var r=s[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}var s={};i.m=t,i.c=s,i.d=function(t,s,o){i.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:o})},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=0)}([function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});let o=new(s(1).a)({}),r={};onmessage=function(t){clearTimeout(r),r=setTimeout(function(){o.setAxiom(t.data.axiom),o.clearProductions();for(let i of t.data.productions)o.setProduction(i[0],i[1]);o.iterate(t.data.iterations),postMessage({result:o.getString(),initial:t.data})},20)}},function(t,i){"use strict";function s(t){var i,s,o=t[0].match(/(.+)<(.)/),r=t[0].match(/(.)>(.+)/);return null===o&&null===r?t:(i=void 0,s=t[1].successor||t[1].successors?t[1]:{successor:t[1]},null!==o&&(i=o[2],s.leftCtx=o[1]),null!==r&&(i=r[1],s.rightCtx=r[2]),[i,s])}function o(t){var i,s,o,r,e,n;if("string"!=typeof t&&t instanceof String==!1)return t;for(i=[],s=t,r=0,s=(o=Array.isArray(s))?s:s[Symbol.iterator]();;){if(o){if(r>=s.length)break;e=s[r++]}else{if((r=s.next()).done)break;e=r.value}n=e,i.push({symbol:n})}return i}function r(t,i){if(t.hasOwnProperty("successors"))for(var s=0;s<t.successors.length;s++)t.successors[s]=r(t.successors[s],i);else!1===t.hasOwnProperty("successor")&&(t={successor:t});return i&&t.hasOwnProperty("successor")&&(t.successor=o(t.successor)),t}function e(t,i){return t[1]=r(t[1],i),t}function LSystem(t){var i=t.axiom,r=void 0===i?"":i,n=t.productions,a=t.finals,c=t.branchSymbols,u=void 0===c?"":c,h=t.ignoredSymbols,l=void 0===h?"":h,f=t.allowClassicSyntax,d=void 0===f||f,m=t.classicParametricSyntax,y=void 0!==m&&m,g=t.forceObjects,b=void 0!==g&&g,v=t.debug,p=void 0!==v&&v;return this.setAxiom=function(t){this.axiom=this.forceObjects?o(t):t},this.getRaw=function(){return this.axiom},this.getString=function(){var t=0>=arguments.length||void 0===arguments[0]||arguments[0];return"string"==typeof this.axiom?this.axiom:!0===t?this.axiom.reduce((t,i)=>{if(void 0===i.symbol)throw console.log("found:",i),Error("L-Systems that use only objects as symbols (eg: {symbol: \'F\', params: []}), cant use string symbols (eg. \'F\')! Check if you always return objects in your productions and no strings.");return t+i.symbol},""):JSON.stringify(this.axiom)},this.getStringResult=this.getString,this.setProduction=function(t,i){var o,r,n,a,c,u,h,l,f,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=[t,i];if(void 0===m)throw Error("no production specified.");if(i.successor&&i.successors)throw Error(\'You can not have both a "successor" and a "successors" field in your production!\');if(!0===this.allowClassicSyntax&&(m=s(m,this.ignoredSymbols)),m=e(m,this.forceObjects),m[1].isStochastic=void 0!==m[1].successors&&m[1].successors.every(t=>void 0!==t.weight),m[1].isStochastic)for(m[1].weightSum=0,o=m[1].successors,n=0,o=(r=Array.isArray(o))?o:o[Symbol.iterator]();;){if(r){if(n>=o.length)break;a=o[n++]}else{if((n=o.next()).done)break;a=n.value}c=a,m[1].weightSum+=c.weight}u=m[0],!0===d&&this.productions.has(u)?(l=(h=this.productions.get(u)).successor,f=h.successors,l&&!f&&(h={successors:[h]}),h.successors.push(m[1]),this.productions.set(u,h)):this.productions.set(u,m[1])},this.setProductions=function(t){var i,s,o,r,e,n,a;if(void 0===t)throw Error("no production specified.");for(this.clearProductions(),i=Object.entries(t),o=0,i=(s=Array.isArray(i))?i:i[Symbol.iterator]();;){if(s){if(o>=i.length)break;r=i[o++]}else{if((o=i.next()).done)break;r=o.value}n=(e=r)[0],a=e[1],this.setProduction(n,a,!0)}},this.clearProductions=function(){this.productions=new Map},this.setFinal=function(t,i){var s=[t,i];if(void 0===s)throw Error("no final specified.");this.finals.set(s[0],s[1])},this.setFinals=function(t){if(void 0===t)throw Error("no finals specified.");this.finals=new Map;for(var i in t)t.hasOwnProperty(i)&&this.setFinal(i,t[i])},this.getProductionResult=function(t,i,s,o){var r,e,n,a,c,u,h,f,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=void 0!==t.leftCtx||void 0!==t.rightCtx,y=!1,g=!0;if(void 0!==t.condition&&!1===t.condition({index:i,currentAxiom:this.axiom,part:s,params:o})?g=!1:m&&(void 0!==t.leftCtx&&void 0!==t.rightCtx?g=this.match({direction:"left",match:t.leftCtx,index:i,branchSymbols:"[]"}).result&&this.match({direction:"right",match:t.rightCtx,index:i,branchSymbols:"[]",ignoredSymbols:l}).result:void 0!==t.leftCtx?g=this.match({direction:"left",match:t.leftCtx,index:i,branchSymbols:"[]"}).result:void 0!==t.rightCtx&&(g=this.match({direction:"right",match:t.rightCtx,index:i,branchSymbols:"[]"}).result)),!1===g)y=!1;else if(t.successors)for(t.isStochastic&&(e=Math.random()*t.weightSum,r=0),n=t.successors,c=0,n=(a=Array.isArray(n))?n:n[Symbol.iterator]();;){if(a){if(c>=n.length)break;u=n[c++]}else{if((c=n.next()).done)break;u=c.value}if(h=u,!(t.isStochastic&&(r+=h.weight)<e||void 0===(f=this.getProductionResult(h,i,s,o,!0))||!1===f)){y=f;break}}else y="function"==typeof t.successor?t.successor({index:i,currentAxiom:this.axiom,part:s,params:o}):t.successor;return y||(d?y:s)},this.applyProductions=function(){var t,i,s,o,r,e,n,a,c,u="string"==typeof this.axiom?"":[],h=0;for(t=this.axiom,s=0,t=(i=Array.isArray(t))?t:t[Symbol.iterator]();;){if(i){if(s>=t.length)break;o=t[s++]}else{if((s=t.next()).done)break;o=s.value}e=(r=o).symbol||r,n=r.params||[],a=r,this.productions.has(e)&&(c=this.productions.get(e),a=this.getProductionResult(c,h,r,n)),"string"==typeof u?u+=a:a instanceof Array?Array.prototype.push.apply(u,a):u.push(a),h++}return this.axiom=u,u},this.iterate=function(){var t,i,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(this.iterations=s,t=void 0,i=0;s>i;i++)t=this.applyProductions();return t},this.final=function(t){var i,s,o,r,e,n,a,c,u=0;for(i=this.axiom,o=0,i=(s=Array.isArray(i))?i:i[Symbol.iterator]();;){if(s){if(o>=i.length)break;r=i[o++]}else{if((o=i.next()).done)break;r=o.value}if(e=r,n=e,"object"==typeof e&&e.symbol&&(n=e.symbol),this.finals.has(n)){if(a=this.finals.get(n),"function"!==(c=typeof a))throw Error("\'"+n+"\' has an object for a final function. But it is __not a function__ but a "+c+"!");a({index:u,part:e},t)}u++}},this.match=function(t){var i,s,o,r,e,n,a,c,u,h,l,f,d=t.axiom_,m=t.match,y=t.ignoredSymbols,g=t.branchSymbols,b=t.index,v=t.direction,p=0,x=0;if(d=d||this.axiom,void 0===g&&(g=void 0!==this.branchSymbols?this.branchSymbols:[]),void 0===y&&(y=void 0!==this.ignoredSymbols?this.ignoredSymbols:[]),i=[],s=void 0,o=void 0,r=void 0,e=void 0,n=void 0,a=void 0,c=void 0,"right"===v)e=a=1,r=b+1,n=0,c=m.length,g.length>0&&(s=(u=g)[0],o=u[1]);else{if("left"!==v)throw Error(v,"is not a valid direction for matching.");e=a=-1,r=b-1,n=m.length-1,c=-1,g.length>0&&(o=(h=g)[0],s=h[1])}for(;r<d.length&&r>=0;r+=e)if(l=d[r].symbol||d[r],f=m[n],l===f){if((0===p||x>0)&&(l===s?(x++,p++,n+=a):l===o?(x=Math.max(0,x-1),p=Math.max(0,p-1),0===x&&(n+=a)):(i.push(r),n+=a)),n===c)return{result:!0,matchIndices:i}}else if(l===s)p++,x>0&&x++;else if(l===o)p=Math.max(0,p-1),x>0&&(x=Math.max(0,x-1));else if((0===p||x>0&&f!==o)&&!1===y.includes(l))return{result:!1,matchIndices:i};return{result:!1,matchIndices:i}},this.ignoredSymbols=l,this.debug=p,this.branchSymbols=u,this.allowClassicSyntax=d,this.classicParametricSyntax=y,this.forceObjects=b,this.setAxiom(r),this.clearProductions(),n&&this.setProductions(n),a&&this.setFinals(a),this}LSystem.transformClassicStochasticProductions=function(t){return function(){var i,s=t,o=s.length,r=Math.random();for(i=0;o>i;i++)if((i+1)/o>=r)return s[i];console.error("Should have returned a result of the list, something is wrong here with the random numbers?.")}},LSystem.transformClassicCSProduction=s,LSystem.transformClassicParametricAxiom=function(t){var i,s,o=t.replace(/\\s+/g,"").split(/[\\(\\)]/),r=[];for(i=0;i<o.length-1;i+=2)s=o[i+1].split(",").map(Number),r.push({symbol:o[i],params:s})},LSystem.testClassicParametricSyntax=function(t){return/\\(.+\\)/.test(t)},i.a=LSystem}]);',null)}},function(t){var e=window.URL||window.webkitURL;t.exports=function(t,i){var s;try{try{try{(s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),s=s.getBlob()}catch(e){s=new Blob([t])}return new Worker(e.createObjectURL(s))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!i)throw Error("Inline worker is not supported");return new Worker(i)}}},function(){AFRAME.registerPrimitive("a-lsystem",{defaultComponents:{lsystem:{axiom:"F",productions:"F:F++F++F++F",iterations:3,angle:60}},mappings:{axiom:"lsystem.axiom",productions:"lsystem.productions",segmentMixins:"lsystem.segmentMixins",iterations:"lsystem.iterations",angle:"lsystem.angle"}})}]);